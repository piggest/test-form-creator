<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>テスト回答欄作成ツール</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- ヘッダー -->
        <header class="header">
            <h1>テスト回答欄作成ツール</h1>
            <div class="mode-toggle">
                <button id="editModeBtn" class="mode-btn active">編集モード</button>
                <button id="previewModeBtn" class="mode-btn">プレビュー</button>
            </div>
        </header>

        <!-- 編集モード -->
        <main id="editMode" class="main-content">
            <!-- テスト情報 -->
            <section class="test-info">
                <input type="text" id="testTitle" placeholder="テストタイトル" value="テスト">
                <input type="text" id="testSubtitle" placeholder="サブタイトル（任意）">
                <div class="max-score-input">
                    <label for="maxScore">最大点：</label>
                    <input type="number" id="maxScore" value="100" min="1">
                    <span>点</span>
                </div>
                <div class="vertical-toggle">
                    <label>
                        <input type="checkbox" id="verticalMode">
                        縦書きモード（縦書き解答用紙）
                    </label>
                </div>
                <div class="label-format-input">
                    <label for="rootLabelFormat">段落番号形式：</label>
                    <select id="rootLabelFormat">
                        <option value="boxed">□（四角囲み）</option>
                        <option value="parenthesis">()（カッコ）</option>
                        <option value="circled">○（丸数字）</option>
                    </select>
                </div>
            </section>

            <!-- 段落追加 -->
            <section class="add-section-panel">
                <button id="addParagraphBtn" class="add-section-btn">＋ 段落を追加</button>
            </section>

            <!-- 段落リスト -->
            <section id="paragraphsContainer">
                <p class="empty-message">段落がまだありません。上のボタンから追加してください。</p>
            </section>

            <!-- データ管理 -->
            <section class="data-management">
                <button id="newBtn" class="data-btn new-btn">新規作成</button>
                <button id="saveBtn" class="data-btn">JSONで保存</button>
                <button id="loadBtn" class="data-btn">JSONを読み込み</button>
                <input type="file" id="fileInput" accept=".json" style="display: none;">
            </section>
        </main>

        <!-- プレビューモード -->
        <main id="previewMode" class="main-content" style="display: none;">
            <div class="preview-controls no-print">
                <label class="toggle-label">
                    <input type="checkbox" id="showAnswers">
                    <span>答えを表示</span>
                </label>
                <button id="printBtn" class="print-btn">印刷</button>
                <button id="pdfBtn" class="pdf-btn">PDF保存</button>
                <button id="jsonSaveBtn" class="json-btn">JSON保存</button>
            </div>
            <div id="previewContent" class="preview-content">
            </div>
        </main>
    </div>

    <!-- 段落編集モーダル -->
    <div id="paragraphModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3 id="paragraphModalTitle">段落を編集</h3>
            <form id="paragraphForm">
                <input type="hidden" id="paragraphId">
                <div class="form-group">
                    <label for="paragraphText">段落見出し（任意）</label>
                    <input type="text" id="paragraphText" placeholder="例: 次の文章を読んで答えなさい">
                </div>
                <div class="form-group">
                    <label for="labelFormat">子段落の番号形式</label>
                    <select id="labelFormat">
                        <option value="parenthesis">()（カッコ）</option>
                        <option value="circled">○（丸数字）</option>
                        <option value="boxed">□（四角囲み）</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="showInnerLabel" checked>
                        回答欄の内部ラベル表示（①②...）
                    </label>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="cancel-btn" data-modal="paragraph">キャンセル</button>
                    <button type="submit" class="submit-btn">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 回答欄編集モーダル -->
    <div id="answerFieldModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3 id="answerFieldModalTitle">回答欄を編集</h3>
            <form id="answerFieldForm">
                <input type="hidden" id="answerFieldParagraphId">
                <input type="hidden" id="answerFieldId">

                <div class="form-group">
                    <label for="answerFieldType">回答欄タイプ</label>
                    <select id="answerFieldType">
                        <option value="symbol">記号回答式</option>
                        <option value="text">記述式</option>
                        <option value="number">数値記述式</option>
                        <option value="grid">原稿用紙形式</option>
                    </select>
                </div>

                <!-- 記述式オプション -->
                <div id="textOptions" class="form-group" style="display: none;">
                    <div class="text-size-inputs">
                        <div>
                            <label for="textWidth">文字数幅</label>
                            <input type="number" id="textWidth" value="3" min="1" max="20">
                        </div>
                        <div>
                            <label for="textRows">行数</label>
                            <input type="number" id="textRows" value="1" min="1" max="20">
                        </div>
                    </div>
                    <div class="suffix-input" style="margin-top: 12px;">
                        <label for="suffixText">解答欄の後ろのテキスト（任意）</label>
                        <input type="text" id="suffixText" placeholder="例: と考える。">
                    </div>
                </div>

                <!-- 原稿用紙形式オプション -->
                <div id="gridOptions" class="form-group" style="display: none;">
                    <label>文字数</label>
                    <div class="char-limit-inputs">
                        <input type="number" id="gridChars" placeholder="文字数" min="1" value="5">
                        <span>文字</span>
                    </div>
                    <div class="suffix-input" style="margin-top: 12px;">
                        <label for="gridSuffixText">解答欄の後ろのテキスト（任意）</label>
                        <input type="text" id="gridSuffixText" placeholder="例: と考える。">
                    </div>
                </div>

                <!-- 回答欄数オプション -->
                <div id="answerCountOptions" class="form-group" style="display: none;">
                    <label for="answerCount">回答欄の数</label>
                    <input type="number" id="answerCount" value="1" min="1" max="20">
                </div>

                <!-- 数値記述式オプション -->
                <div id="numberOptions" class="form-group" style="display: none;">
                    <label>数値形式</label>
                    <div class="number-format-select">
                        <label><input type="radio" name="numberFormat" value="simple" checked> 単純な数値</label>
                        <label><input type="radio" name="numberFormat" value="ratio"> 比率（A：B）</label>
                        <label><input type="radio" name="numberFormat" value="time"> 時間（分秒）</label>
                    </div>
                    <div class="unit-input">
                        <label for="numberUnit">単位（任意）</label>
                        <select id="numberUnit">
                            <option value="">なし</option>
                            <option value="cm">cm</option>
                            <option value="cm²">cm²</option>
                            <option value="cm³">cm³</option>
                            <option value="m">m</option>
                            <option value="m²">m²</option>
                            <option value="m³">m³</option>
                            <option value="km">km</option>
                            <option value="km²">km²</option>
                            <option value="mm">mm</option>
                            <option value="g">g</option>
                            <option value="kg">kg</option>
                            <option value="L">L</option>
                            <option value="mL">mL</option>
                            <option value="dL">dL</option>
                            <option value="円">円</option>
                            <option value="個">個</option>
                            <option value="人">人</option>
                            <option value="本">本</option>
                            <option value="枚">枚</option>
                            <option value="度">度</option>
                            <option value="秒">秒</option>
                            <option value="分">分</option>
                            <option value="時間">時間</option>
                            <option value="%">%</option>
                            <option value="倍">倍</option>
                            <option value="__custom__">その他（自由入力）</option>
                        </select>
                        <input type="text" id="numberUnitCustom" placeholder="単位を入力" style="display: none; margin-top: 8px;">
                    </div>
                    <div id="ratioCountOption" style="display: none;">
                        <label for="ratioCount">比率の項目数</label>
                        <input type="number" id="ratioCount" value="2" min="2" max="5">
                    </div>
                </div>

                <!-- 答え入力 -->
                <div class="form-group answer-input-group">
                    <label for="answerValue">答え（任意）</label>
                    <input type="text" id="answerValue" placeholder="正解を入力">
                </div>

                <div class="modal-buttons">
                    <button type="button" class="cancel-btn" data-modal="answerField">キャンセル</button>
                    <button type="submit" class="submit-btn">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/utils.js"></script>
    <script src="js/state.js"></script>
    <script src="js/paragraphs.js"></script>
    <script src="js/answerFields.js"></script>
    <script src="js/render.js"></script>
    <script src="js/vertical.js"></script>
    <script src="js/export.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
